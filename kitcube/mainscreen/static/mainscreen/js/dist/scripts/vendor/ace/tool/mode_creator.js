define(["require","exports","module","ace/lib/net","ace/range","demo/kitchen-sink/util","demo/kitchen-sink/layout","ace/ext/modelist","demo/kitchen-sink/doclist","demo/kitchen-sink/token_tooltip","ace/edit_session","ace/undomanager","ace/tokenizer_dev","ace/tokenizer"],function(require,exports,module){function getDeps(e,t){var n=[];return e.replace(/require\((['"])(.*?)\1/g,function(e,r,i){if(i[0]=="."){var s=t.split("/");i.split("/").forEach(function(e){e=="."?s.pop():e==".."?(s.pop(),s.pop()):s.push(e)}),i=s.join("/")}n.push('"'+i+'"')}),n}function run(){var src=editor1.getValue(),path="ace/mode/new",deps=getDeps(src,path);window.require.undef(path),src=src.replace("define(",'define("'+path+'", ["require","exports","module",'+deps+"],");try{eval(src),require(["ace/mode/new"],function(e){try{continueRun(e)}catch(e){log(e)}},function(e){log(e),window.require.undef(path)}),hideLog()}catch(e){log(e)}}function log(e){console.log(e),logEditor||(logEditor=util.createEditor(document.getElementById("consoleEditor")),logEditor.session.setMode("ace/mode/javascript"),logEditor.session.setUseWorker(!1)),logEditor.container.parentNode.style.display="",logEditor.resize(),logEditor.navigateFileEnd(e),logEditor.insert(e+"\n")}function hideLog(){logEditor&&(logEditor.container.parentNode.style.display="none")}var net=require("ace/lib/net"),Range=require("ace/range").Range,util=require("demo/kitchen-sink/util"),layout=require("demo/kitchen-sink/layout"),modelist=require("ace/ext/modelist"),doclist=require("demo/kitchen-sink/doclist"),TokenTooltip=require("demo/kitchen-sink/token_tooltip").TokenTooltip,EditSession=require("ace/edit_session").EditSession,UndoManager=require("ace/undomanager").UndoManager,DebugTokenizer=require("ace/tokenizer_dev").Tokenizer,Tokenizer=require("ace/tokenizer").Tokenizer,splitEditor=window.splitEditor=util.createSplitEditor("editor"),editor1=window.editor1=splitEditor.editor0,editor2=window.editor2=splitEditor.editor1;new TokenTooltip(editor2);var timeout=null,schedule=function(){timeout!=null&&clearTimeout(timeout),timeout=setTimeout(run,800)},setAutorunEnabled=function(e){e?editor1.on("change",schedule):editor1.removeEventListener("change",schedule)};util.bindCheckbox("autorunEl",setAutorunEnabled);var docEl=document.getElementById("doc");util.fillDropdown(docEl,doclist.docs),util.bindDropdown("doc",function(e){doclist.loadDoc(e,function(e){e&&editor2.setSession(e)})});var modeEl=document.getElementById("modeEl");util.fillDropdown(modeEl,modelist.modes);var modeSessions={};util.bindDropdown(modeEl,function(e){if(modeSessions[e]){editor1.setSession(modeSessions[e]),schedule();return}var t="./lib/ace/mode/"+e+"_highlight_rules.js";net.get(t,function(t){t=util.stripLeadingComments(t);var n=new EditSession(t);n.setUndoManager(new UndoManager),modeSessions[e]=n,n.setMode("ace/mode/javascript"),editor1.setSession(modeSessions[e]),schedule()})}),document.getElementById("syncToMode").onclick=function(){docEl.value=modelist.modesByName[modeEl.value].desc,docEl.onchange(),run()},document.getElementById("perfTest").onclick=function(){var e=editor2.session.doc.getAllLines();if(!e.length)return;while(e.length<1e3)e=e.concat(e);var t=new Tokenizer(currentRules),n=function(e,t){var n="start";for(var r=0,i=e.length;r<i;r++)n=t.getLineTokens(e[r],n).state},r=performance.now();n(e,t),r-=performance.now(r),log("tokenized "+e.length+" lines in "+r+" ms")},util.fillDropdown("themeEl",{bright:["chrome","clouds","crimson_editor","dawn","dreamweaver","eclipse","github","solarized_light","textmate","tomorrow","xcode"],dark:["clouds_midnight","cobalt","idle_fingers","kr_theme","merbivore","merbivore_soft","mono_industrial","monokai","pastel_on_dark","solarized_dark","terminal","tomorrow_night","tomorrow_night_blue","tomorrow_night_bright","tomorrow_night_eighties","twilight","vibrant_ink"]}),util.bindDropdown("themeEl",function(e){if(!e)return;editor1.setTheme("ace/theme/"+e),editor2.setTheme("ace/theme/"+e)});var currentRules,continueRun=function(e){e=e[Object.keys(e)[0]],currentRules=(new e).getRules();var t=DebugTokenizer,n=new t(currentRules);editor2.session.$mode.$tokenizer=n,editor2.session.bgTokenizer.setTokenizer(n),editor2.renderer.updateText()};editor1.commands.bindKey("ctrl-Return",run);var logEditor});