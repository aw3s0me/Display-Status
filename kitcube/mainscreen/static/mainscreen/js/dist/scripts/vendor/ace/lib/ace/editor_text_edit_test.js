/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */

typeof process!="undefined"&&(require("amd-loader"),require("./test/mockdom")),define(["require","exports","module","./edit_session","./editor","./mode/javascript","./undomanager","./test/mockrenderer","./test/assertions","./ext/whitespace"],function(e,t,n){var r=e("./edit_session").EditSession,i=e("./editor").Editor,s=e("./mode/javascript").Mode,o=e("./undomanager").UndoManager,u=e("./test/mockrenderer").MockRenderer,a=e("./test/assertions"),f=e("./ext/whitespace");n.exports={"test: delete line from the middle":function(){var e=new r(["a","b","c","d"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,1),t.removeLines(),a.equal(e.toString(),"a\nc\nd"),a.position(t.getCursorPosition(),1,0),t.removeLines(),a.equal(e.toString(),"a\nd"),a.position(t.getCursorPosition(),1,0),t.removeLines(),a.equal(e.toString(),"a"),a.position(t.getCursorPosition(),0,1),t.removeLines(),a.equal(e.toString(),""),a.position(t.getCursorPosition(),0,0)},"test: delete multiple selected lines":function(){var e=new r(["a","b","c","d"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,1),t.getSelection().selectDown(),t.removeLines(),a.equal(e.toString(),"a\nd"),a.position(t.getCursorPosition(),1,0)},"test: delete first line":function(){var e=new r(["a","b","c"].join("\n")),t=new i(new u,e);t.removeLines(),a.equal(e.toString(),"b\nc"),a.position(t.getCursorPosition(),0,0)},"test: delete last should also delete the new line of the previous line":function(){var e=new r(["a","b","c",""].join("\n")),t=new i(new u,e);t.moveCursorTo(3,0),t.removeLines(),a.equal(e.toString(),"a\nb\nc"),a.position(t.getCursorPosition(),2,1),t.removeLines(),a.equal(e.toString(),"a\nb"),a.position(t.getCursorPosition(),1,1)},"test: indent block":function(){var e=new r(["a12345","b12345","c12345"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,3),t.getSelection().selectDown(),t.indent(),a.equal(["a12345","    b12345","    c12345"].join("\n"),e.toString()),a.position(t.getCursorPosition(),2,7);var n=t.getSelectionRange();a.position(n.start,1,7),a.position(n.end,2,7)},"test: indent selected lines":function(){var e=new r(["a12345","b12345","c12345"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,0),t.getSelection().selectDown(),t.indent(),a.equal(["a12345","    b12345","c12345"].join("\n"),e.toString())},"test: no auto indent if cursor is before the {":function(){var e=new r("{",new s),t=new i(new u,e);t.moveCursorTo(0,0),t.onTextInput("\n"),a.equal(["","{"].join("\n"),e.toString())},"test: outdent block":function(){var e=new r(["        a12345","    b12345","        c12345"].join("\n")),t=new i(new u,e);t.moveCursorTo(0,5),t.getSelection().selectDown(),t.getSelection().selectDown(),t.blockOutdent(),a.equal(e.toString(),["    a12345","b12345","    c12345"].join("\n")),a.position(t.getCursorPosition(),2,1);var n=t.getSelectionRange();a.position(n.start,0,1),a.position(n.end,2,1),t.blockOutdent(),a.equal(e.toString(),["a12345","b12345","c12345"].join("\n"));var n=t.getSelectionRange();a.position(n.start,0,0),a.position(n.end,2,0)},"test: outent without a selection should update cursor":function(){var e=new r("        12"),t=new i(new u,e);t.moveCursorTo(0,3),t.blockOutdent("  "),a.equal(e.toString(),"    12"),a.position(t.getCursorPosition(),0,0)},"test: comment lines should perserve selection":function(){var e=new r(["  abc","cde"].join("\n"),new s),t=new i(new u,e);f.detectIndentation(e),t.moveCursorTo(0,2),t.getSelection().selectDown(),t.toggleCommentLines(),a.equal(["//   abc","// cde"].join("\n"),e.toString());var n=t.getSelectionRange();a.position(n.start,0,5),a.position(n.end,1,5)},"test: uncomment lines should perserve selection":function(){var e=new r(["//   abc","//cde"].join("\n"),new s),t=new i(new u,e);e.setTabSize(2),t.moveCursorTo(0,1),t.getSelection().selectDown(),t.getSelection().selectRight(),t.getSelection().selectRight(),t.toggleCommentLines(),a.equal(["  abc","cde"].join("\n"),e.toString()),a.range(t.getSelectionRange(),0,0,1,1)},"test: toggle comment lines twice should return the original text":function(){var e=new r(["  abc","cde","fg"],new s),t=new i(new u,e);t.moveCursorTo(0,0),t.getSelection().selectDown(),t.getSelection().selectDown(),t.toggleCommentLines(),t.toggleCommentLines(),a.equal(["  abc","cde","fg"].join("\n"),e.toString())},"test: comment lines - if the selection end is at the line start it should stay there":function(){var e=new r(["abc","cde"].join("\n"),new s),t=new i(new u,e);t.moveCursorTo(0,0),t.getSelection().selectDown(),t.toggleCommentLines(),a.range(t.getSelectionRange(),0,3,1,0);var e=new r(["abc","cde"].join("\n"),new s),t=new i(new u,e);t.moveCursorTo(1,0),t.getSelection().selectUp(),t.toggleCommentLines(),a.range(t.getSelectionRange(),0,3,1,0)},"test: move lines down should keep selection on moved lines":function(){var e=new r(["11","22","33","44"].join("\n")),t=new i(new u,e);t.moveCursorTo(0,1),t.getSelection().selectDown(),t.moveLinesDown(),a.equal(["33","11","22","44"].join("\n"),e.toString()),a.position(t.getCursorPosition(),2,1),a.position(t.getSelection().getSelectionAnchor(),1,1),a.position(t.getSelection().getSelectionLead(),2,1),t.moveLinesDown(),a.equal(["33","44","11","22"].join("\n"),e.toString()),a.position(t.getCursorPosition(),3,1),a.position(t.getSelection().getSelectionAnchor(),2,1),a.position(t.getSelection().getSelectionLead(),3,1),t.moveLinesDown(),a.equal(["33","44","11","22"].join("\n"),e.toString()),a.position(t.getCursorPosition(),3,1),a.position(t.getSelection().getSelectionAnchor(),2,1),a.position(t.getSelection().getSelectionLead(),3,1)},"test: move lines up should keep selection on moved lines":function(){var e=new r(["11","22","33","44"].join("\n")),t=new i(new u,e);t.moveCursorTo(2,1),t.getSelection().selectDown(),t.moveLinesUp(),a.equal(e.toString(),["11","33","44","22"].join("\n")),a.position(t.getCursorPosition(),2,1),a.position(t.getSelection().getSelectionAnchor(),1,1),a.position(t.getSelection().getSelectionLead(),2,1),t.moveLinesUp(),a.equal(e.toString(),["33","44","11","22"].join("\n")),a.position(t.getCursorPosition(),1,1),a.position(t.getSelection().getSelectionAnchor(),0,1),a.position(t.getSelection().getSelectionLead(),1,1)},"test: move line without active selection should not move cursor relative to the moved line":function(){var e=new r(["11","22","33","44"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,1),t.clearSelection(),t.moveLinesDown(),a.equal(["11","33","22","44"].join("\n"),e.toString()),a.position(t.getCursorPosition(),2,1),t.clearSelection(),t.moveLinesUp(),a.equal(["11","22","33","44"].join("\n"),e.toString()),a.position(t.getCursorPosition(),1,1)},"test: copy lines down should keep selection":function(){var e=new r(["11","22","33","44"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,1),t.getSelection().selectDown(),t.copyLinesDown(),a.equal(["11","22","33","22","33","44"].join("\n"),e.toString()),a.position(t.getCursorPosition(),4,1),a.position(t.getSelection().getSelectionAnchor(),3,1),a.position(t.getSelection().getSelectionLead(),4,1)},"test: copy lines up should keep selection":function(){var e=new r(["11","22","33","44"].join("\n")),t=new i(new u,e);t.moveCursorTo(1,1),t.getSelection().selectDown(),t.copyLinesUp(),a.equal(["11","22","33","22","33","44"].join("\n"),e.toString()),a.position(t.getCursorPosition(),2,1),a.position(t.getSelection().getSelectionAnchor(),1,1),a.position(t.getSelection().getSelectionLead(),2,1)},"test: input a tab with soft tab should convert it to spaces":function(){var e=new r(""),t=new i(new u,e);e.setTabSize(2),e.setUseSoftTabs(!0),t.onTextInput("	"),a.equal(e.toString(),"  "),e.setTabSize(5),t.onTextInput("	"),a.equal(e.toString(),"       ")},"test: input tab without soft tabs should keep the tab character":function(){var e=new r(""),t=new i(new u,e);e.setUseSoftTabs(!1),t.onTextInput("	"),a.equal(e.toString(),"	")},"test: undo/redo for delete line":function(){var e=new r(["111","222","333"]),t=new o;e.setUndoManager(t);var n=e.toString(),s=new i(new u,e);s.removeLines();var f=e.toString();a.equal(f,"222\n333"),e.$syncInformUndoManager(),s.removeLines();var l=e.toString();a.equal(l,"333"),e.$syncInformUndoManager(),s.removeLines();var c=e.toString();a.equal(c,""),e.$syncInformUndoManager(),t.undo(),e.$syncInformUndoManager(),a.equal(e.toString(),l),t.undo(),e.$syncInformUndoManager(),a.equal(e.toString(),f),t.undo(),e.$syncInformUndoManager(),a.equal(e.toString(),n),t.undo(),e.$syncInformUndoManager(),a.equal(e.toString(),n)},"test: remove left should remove character left of the cursor":function(){var e=new r(["123","456"]),t=new i(new u,e);t.moveCursorTo(1,1),t.remove("left"),a.equal(e.toString(),"123\n56")},"test: remove left should remove line break if cursor is at line start":function(){var e=new r(["123","456"]),t=new i(new u,e);t.moveCursorTo(1,0),t.remove("left"),a.equal(e.toString(),"123456")},"test: remove left should remove tabsize spaces if cursor is on a tab stop and preceeded by spaces":function(){var e=new r(["123","        456"]);e.setUseSoftTabs(!0),e.setTabSize(4);var t=new i(new u,e);t.moveCursorTo(1,8),t.remove("left"),a.equal(e.toString(),"123\n    456")},"test: transpose at line start should be a noop":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,0),t.transposeLetters(),a.equal(e.getValue(),["123","4567","89"].join("\n"))},"test: transpose in line should swap the charaters before and after the cursor":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,2),t.transposeLetters(),a.equal(e.getValue(),["123","4657","89"].join("\n"))},"test: transpose at line end should swap the last two characters":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,4),t.transposeLetters(),a.equal(e.getValue(),["123","4576","89"].join("\n"))},"test: transpose with non empty selection should be a noop":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,1),t.getSelection().selectRight(),t.transposeLetters(),a.equal(e.getValue(),["123","4567","89"].join("\n"))},"test: transpose should move the cursor behind the last swapped character":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,2),t.transposeLetters(),a.position(t.getCursorPosition(),1,3)},"test: remove to line end":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,2),t.removeToLineEnd(),a.equal(e.getValue(),["123","45","89"].join("\n"))},"test: remove to line end at line end should remove the new line":function(){var e=new r(["123","4567","89"]),t=new i(new u,e);t.moveCursorTo(1,4),t.removeToLineEnd(),a.position(t.getCursorPosition(),1,4),a.equal(e.getValue(),["123","456789"].join("\n"))},"test: transform selection to uppercase":function(){var e=new r(["ajax","dot","org"]),t=new i(new u,e);t.moveCursorTo(1,0),t.getSelection().selectLineEnd(),t.toUpperCase(),a.equal(e.getValue(),["ajax","DOT","org"].join("\n"))},"test: transform word to uppercase":function(){var e=new r(["ajax","dot","org"]),t=new i(new u,e);t.moveCursorTo(1,0),t.toUpperCase(),a.equal(e.getValue(),["ajax","DOT","org"].join("\n")),a.position(t.getCursorPosition(),1,0)},"test: transform selection to lowercase":function(){var e=new r(["AJAX","DOT","ORG"]),t=new i(new u,e);t.moveCursorTo(1,0),t.getSelection().selectLineEnd(),t.toLowerCase(),a.equal(e.getValue(),["AJAX","dot","ORG"].join("\n"))},"test: transform word to lowercase":function(){var e=new r(["AJAX","DOT","ORG"]),t=new i(new u,e);t.moveCursorTo(1,0),t.toLowerCase(),a.equal(e.getValue(),["AJAX","dot","ORG"].join("\n")),a.position(t.getCursorPosition(),1,0)}}}),typeof module!="undefined"&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();