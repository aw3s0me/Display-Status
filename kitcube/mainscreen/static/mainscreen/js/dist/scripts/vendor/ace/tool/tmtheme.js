function parseTheme(e,t){parseString(e,function(e,n){t(n[0])})}function extractStyles(e){var t=e.settings[0].settings,n={printMargin:"#e8e8e8",background:parseColor(t.background),foreground:parseColor(t.foreground),gutter:"#e8e8e8",selection:parseColor(t.selection),step:"rgb(198, 219, 174)",bracket:parseColor(t.invisibles),active_line:parseColor(t.lineHighlight),cursor:parseColor(t.caret),invisible:"color: "+parseColor(t.invisibles)+";"};for(var r=1;r<e.settings.length;r++){var i=e.settings[r];if(!i.scope)continue;var s=i.scope.split(/\s*[|,]\s*/g);for(var o=0;o<s.length;o++){var u=s[o],a=parseStyles(i.settings),f=supportedScopes[u];f?n[f]=a:a&&(unsupportedScopes[u]=(unsupportedScopes[u]||0)+1)}}for(var r in fallbackScopes)n[r]||(n[r]=n[fallbackScopes[r]]);if(!n.fold){var l=n["entity.name.function"]||n.keyword;l&&(n.fold=l.match(/\:([^;]+)/)[1])}return n.selected_word_highlight||(n.selected_word_highlight="border: 1px solid "+n.selection+";"),n.isDark=(luma(n.background)<.5)+"",n}function luma(e){if(e[0]=="#")var t=e.match(/^#(..)(..)(..)/).slice(1).map(function(e){return parseInt(e,16)});else var t=e.match(/\(([^,]+),([^,]+),([^,]+)/).slice(1).map(function(e){return parseInt(e,10)});return(.21*t[0]+.72*t[1]+.07*t[2])/255}function parseColor(e){e.length==4&&(e=e.replace(/[a-fA-F\d]/g,"$&$&"));if(e.length==7)return e;e.match(/^#(..)(..)(..)(..)$/)||console.error("can't parse color",e);var t=e.match(/^#(..)(..)(..)(..)$/).slice(1).map(function(e){return parseInt(e,16)});return t[3]=(t[3]/255).toPrecision(2),"rgba("+t.join(", ")+")"}function parseStyles(e){var t=[],n=e.fontStyle||"";return n.indexOf("underline")!==-1&&t.push("text-decoration:underline;"),n.indexOf("italic")!==-1&&t.push("font-style:italic;"),e.foreground&&t.push("color:"+parseColor(e.foreground)+";"),e.background&&t.push("background-color:"+parseColor(e.background)+";"),t.join("\n")}function fillTemplate(e,t){return e.replace(/%(.+?)%/g,function(e,n){return t[n]||""})}function hyphenate(e){return e.replace(/([A-Z])/g,"-$1").replace(/_/g,"-").toLowerCase()}function quoteString(e){return'"'+e.replace(/\\/,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"'}function normalizeStylesheet(e){for(var t=e.length;t--;){var n=JSON.stringify(e[t].declarations);for(var r=t;r--;)if(n==JSON.stringify(e[r].declarations)){console.log(e[r].selectors,e[t].selectors),console.log(t,r),e[r].selectors=e[t].selectors.concat(e[r].selectors),e.splice(t,1);break}}for(var t=e.length;t--;){var n=e[t].selectors.sort();e[t].selectors=n.filter(function(e,t){return e&&e!=n[t+1]})}return e}function convertTheme(e){console.log("Converting "+e);var t=fs.readFileSync(__dirname+"/tmthemes/"+themes[e]+".tmTheme","utf8");parseTheme(t,function(t){var n=extractStyles(t);n.cssClass="ace-"+hyphenate(e),n.uuid=t.uuid;var r=fillTemplate(cssTemplate,n);r=r.replace(/[^\{\}]+{\s*}/g,"");for(var i in supportedScopes){if(!n[i])continue;r+="."+n.cssClass+" "+i.replace(/^|\./g,".ace_")+"{"+n[i]+"}"}try{var s=fs.readFileSync(__dirname+"/../lib/ace/theme/"+e+".css"),o=cssParse(s).stylesheet.rules,u=cssParse(r).stylesheet.rules;for(var i=0;i<u.length;i++){var a=u[i].selectors;for(var f=0;f<o.length;f++){var l=o[f].selectors;a=a.filter(function(e){return l.indexOf(e)==-1});if(!a.length)break}a.length&&(u[i].selectors=a,console.log("Adding NEW rule: ",u[i]),o.splice(i,0,u[i]))}o=normalizeStylesheet(o),r=cssStringify({stylesheet:{rules:o}},{compress:!1})}catch(c){console.log("Creating new file: "+e+".css")}var h=fillTemplate(jsTemplate,{name:e,css:'require("../requirejs/text!./'+e+'.css")',cssClass:"ace-"+hyphenate(e),isDark:n.isDark});fs.writeFileSync(__dirname+"/../lib/ace/theme/"+e+".js",h),fs.writeFileSync(__dirname+"/../lib/ace/theme/"+e+".css",r)})}var fs=require("fs"),path=require("path"),util=require("util"),cssParse=require("css-parse"),cssStringify=require("css-stringify"),parseString=require("plist").parseString,unsupportedScopes={},supportedScopes={keyword:"keyword","keyword.operator":"keyword.operator","keyword.other.unit":"keyword.other.unit",constant:"constant","constant.language":"constant.language","constant.library":"constant.library","constant.numeric":"constant.numeric","constant.character":"constant.character","constant.character.escape":"constant.character.escape","constant.character.entity":"constant.character.entity","constant.other":"constant.other",support:"support","support.function":"support.function","support.function.dom":"support.function.dom","support.function.firebug":"support.firebug","support.function.constant":"support.function.constant","support.constant":"support.constant","support.constant.property-value":"support.constant.property-value","support.class":"support.class","support.type":"support.type","support.other":"support.other","function":"function","function.buildin":"function.buildin",storage:"storage","storage.type":"storage.type",invalid:"invalid","invalid.illegal":"invalid.illegal","invalid.deprecated":"invalid.deprecated",string:"string","string.regexp":"string.regexp",comment:"comment","comment.documentation":"comment.doc","comment.documentation.tag":"comment.doc.tag",variable:"variable","variable.language":"variable.language","variable.parameter":"variable.parameter",meta:"meta","meta.tag.sgml.doctype":"xml-pe","meta.tag":"meta.tag","meta.selector":"meta.selector","entity.other.attribute-name":"entity.other.attribute-name","entity.name.function":"entity.name.function","entity.name":"entity.name","entity.name.tag":"entity.name.tag","markup.heading":"markup.heading","markup.heading.1":"markup.heading.1","markup.heading.2":"markup.heading.2","markup.heading.3":"markup.heading.3","markup.heading.4":"markup.heading.4","markup.heading.5":"markup.heading.5","markup.heading.6":"markup.heading.6","markup.list":"markup.list","collab.user1":"collab.user1"},fallbackScopes={keyword:"meta","support.type":"storage.type",variable:"entity.name.function"},cssTemplate=fs.readFileSync(__dirname+"/theme.tmpl.css","utf8"),jsTemplate=fs.readFileSync(__dirname+"/theme.tmpl.js","utf8"),themes={clouds:"Clouds",clouds_midnight:"Clouds Midnight",cobalt:"Cobalt",dawn:"Dawn",idle_fingers:"idleFingers",kr_theme:"krTheme",merbivore:"Merbivore",merbivore_soft:"Merbivore Soft",mono_industrial:"monoindustrial",monokai:"Monokai",pastel_on_dark:"Pastels on Dark",solarized_dark:"Solarized-dark",solarized_light:"Solarized-light",katzenmilch:"Katzenmilch",kuroir:"Kuroir Theme",tomorrow:"Tomorrow",tomorrow_night:"Tomorrow-Night",tomorrow_night_blue:"Tomorrow-Night-Blue",tomorrow_night_bright:"Tomorrow-Night-Bright",tomorrow_night_eighties:"Tomorrow-Night-Eighties",twilight:"Twilight",vibrant_ink:"Vibrant Ink",xcode:"Xcode_default"};for(var name in themes)convertTheme(name);var sortedUnsupportedScopes={};for(var u in unsupportedScopes){var value=unsupportedScopes[u];sortedUnsupportedScopes[value]===undefined&&(sortedUnsupportedScopes[value]=[]),sortedUnsupportedScopes[value].push(u)}console.log("I found these unsupported scopes:"),console.log(sortedUnsupportedScopes),console.log("It's safe to ignore these, but they may affect your syntax highlighting if your mode depends on any of these rules."),console.log("Refer to the docs on ace.ajax.org for information on how to add a scope to the CSS generator.");