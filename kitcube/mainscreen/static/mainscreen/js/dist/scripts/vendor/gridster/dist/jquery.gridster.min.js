/*! gridster.js - v0.5.1 - 2014-03-05 - * http://gridster.net/ - Copyright (c) 2014 ducksboard; Licensed MIT */

(function(e){function t(t){return t[0]&&e.isPlainObject(t[0])?this.data=t[0]:this.el=t,this.isCoords=!0,this.coords={},this.init(),this}var n=t.prototype;n.init=function(){this.set(),this.original_coords=this.get()},n.set=function(e,t){var n=this.el;if(n&&!e&&(this.data=n.offset(),this.data.width=n.width(),this.data.height=n.height()),n&&e&&!t){var r=n.offset();this.data.top=r.top,this.data.left=r.left}var i=this.data;return i.left===undefined&&(i.left=i.x1),i.top===undefined&&(i.top=i.y1),this.coords.x1=i.left,this.coords.y1=i.top,this.coords.x2=i.left+i.width,this.coords.y2=i.top+i.height,this.coords.cx=i.left+i.width/2,this.coords.cy=i.top+i.height/2,this.coords.width=i.width,this.coords.height=i.height,this.coords.el=n||!1,this},n.update=function(t){if(!t&&!this.el)return this;if(t){var n=e.extend({},this.data,t);return this.data=n,this.set(!0,!0)}return this.set(!0),this},n.get=function(){return this.coords},n.destroy=function(){this.el.removeData("coords"),delete this.el},e.fn.coords=function(){if(this.data("coords"))return this.data("coords");var e=new t(this,arguments[0]);return this.data("coords",e),e}})(jQuery,window,document),function(e,t,n){function r(t,n,r){this.options=e.extend(i,r),this.$element=t,this.last_colliders=[],this.last_colliders_coords=[],this.set_colliders(n),this.init()}var i={colliders_context:n.body,overlapping_region:"C"},s=r.prototype;s.init=function(){this.find_collisions()},s.overlaps=function(e,t){var n=!1,r=!1;return(t.x1>=e.x1&&t.x1<=e.x2||t.x2>=e.x1&&t.x2<=e.x2||e.x1>=t.x1&&e.x2<=t.x2)&&(n=!0),(t.y1>=e.y1&&t.y1<=e.y2||t.y2>=e.y1&&t.y2<=e.y2||e.y1>=t.y1&&e.y2<=t.y2)&&(r=!0),n&&r},s.detect_overlapping_region=function(e,t){var n="",r="";return e.y1>t.cy&&e.y1<t.y2&&(n="N"),e.y2>t.y1&&e.y2<t.cy&&(n="S"),e.x1>t.cx&&e.x1<t.x2&&(r="W"),e.x2>t.x1&&e.x2<t.cx&&(r="E"),n+r||"C"},s.calculate_overlapped_area_coords=function(t,n){var r=Math.max(t.x1,n.x1),i=Math.max(t.y1,n.y1),s=Math.min(t.x2,n.x2),o=Math.min(t.y2,n.y2);return e({left:r,top:i,width:s-r,height:o-i}).coords().get()},s.calculate_overlapped_area=function(e){return e.width*e.height},s.manage_colliders_start_stop=function(t,n,r){for(var i=this.last_colliders_coords,s=0,o=i.length;o>s;s++)-1===e.inArray(i[s],t)&&n.call(this,i[s]);for(var u=0,a=t.length;a>u;u++)-1===e.inArray(t[u],i)&&r.call(this,t[u])},s.find_collisions=function(t){for(var n=this,r=this.options.overlapping_region,i=[],s=[],o=this.colliders||this.$colliders,u=o.length,a=n.$element.coords().update(t||!1).get();u--;){var f=n.$colliders?e(o[u]):o[u],l=f.isCoords?f:f.coords(),c=l.get(),h=n.overlaps(a,c);if(h){var p=n.detect_overlapping_region(a,c);if(p===r||"all"===r){var d=n.calculate_overlapped_area_coords(a,c),v=n.calculate_overlapped_area(d),m={area:v,area_coords:d,region:p,coords:c,player_coords:a,el:f};n.options.on_overlap&&n.options.on_overlap.call(this,m),i.push(l),s.push(m)}}}return(n.options.on_overlap_stop||n.options.on_overlap_start)&&this.manage_colliders_start_stop(i,n.options.on_overlap_start,n.options.on_overlap_stop),this.last_colliders_coords=i,s},s.get_closest_colliders=function(e){var t=this.find_collisions(e);return t.sort(function(e,t){return"C"===e.region&&"C"===t.region?e.coords.y1<t.coords.y1||e.coords.x1<t.coords.x1?-1:1:e.area<t.area?1:1}),t},s.set_colliders=function(t){"string"==typeof t||t instanceof e?this.$colliders=e(t,this.options.colliders_context).not(this.$element):this.colliders=e(t)},e.fn.collision=function(e,t){return new r(this,e,t)}}(jQuery,window,document),function(e){e.delay=function(e,t){var n=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},e.debounce=function(e,t,n){var r;return function(){var o=this,u=arguments,a=function(){r=null,n||e.apply(o,u)};n&&!r&&e.apply(o,u),clearTimeout(r),r=setTimeout(a,t)}},e.throttle=function(e,t){var n,r,i,s,o,u,a=debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}}}(window),function(e,t,n){function r(t,r){this.options=e.extend({},i,r),this.$body=e(n.body),this.$container=e(t),this.$dragitems=e(this.options.items,this.$container),this.is_dragging=!1,this.player_min_left=0+this.options.offset_left,this.init()}var i={items:"li",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:!0,helper:!1},s=e(t),o={x:"left",y:"top"},u="ontouchstart"in t,a={start:u?"touchstart.gridster-draggable":"mousedown.gridster-draggable",move:u?"touchmove.gridster-draggable":"mousemove.gridster-draggable",end:u?"touchend.gridster-draggable":"mouseup.gridster-draggable"},f=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},l=r.prototype;l.init=function(){var n=this.$container.css("position");this.calculate_dimensions(),this.$container.css("position","static"===n?"relative":n),this.disabled=!1,this.events(),e(t).bind("resize.gridster-draggable",throttle(e.proxy(this.calculate_dimensions,this),200))},l.events=function(){this.$container.on("selectstart.gridster-draggable",e.proxy(this.on_select_start,this)),this.$container.on(a.start,this.options.items,e.proxy(this.drag_handler,this)),this.$body.on(a.end,e.proxy(function(e){this.is_dragging=!1,this.disabled||(this.$body.off(a.move),this.drag_start&&this.on_dragstop(e))},this))},l.get_actual_pos=function(e){var t=e.position();return t},l.get_mouse_pos=function(e){if(u){var t=e.originalEvent;e=t.touches.length?t.touches[0]:t.changedTouches[0]}return{left:e.clientX,top:e.clientY}},l.get_offset=function(e){e.preventDefault();var t=this.get_mouse_pos(e),n=Math.round(t.left-this.mouse_init_pos.left),r=Math.round(t.top-this.mouse_init_pos.top),i=Math.round(this.el_init_offset.left+n-this.baseX+this.scroll_offset_x),s=Math.round(this.el_init_offset.top+r-this.baseY+this.scroll_offset_y);return this.options.limit&&(i>this.player_max_left?i=this.player_max_left:this.player_min_left>i&&(i=this.player_min_left)),{position:{left:i,top:s},pointer:{left:t.left,top:t.top,diff_left:n+this.scroll_offset_x,diff_top:r+this.scroll_offset_y}}},l.get_drag_data=function(e){var t=this.get_offset(e);return t.$player=this.$player,t.$helper=this.helper?this.$helper:this.$player,t},l.set_limits=function(e){return e||(e=this.$container.width()),this.player_max_left=e-this.player_width+ -this.options.offset_left,this.options.container_width=e,this},l.scroll_in=function(t,r){var i,u=o[t],a=50,l=30,c="x"===t,h=c?this.window_width:this.window_height,p=c?e(n).width():e(n).height(),d=c?this.$player.width():this.$player.height(),v=s["scroll"+f(u)](),m=v,g=m+h,y=g-a,b=m+a,w=m+r.pointer[u],E=p-h+d;return w>=y&&(i=v+l,E>i&&(s["scroll"+f(u)](i),this["scroll_offset_"+t]+=l)),b>=w&&(i=v-l,i>0&&(s["scroll"+f(u)](i),this["scroll_offset_"+t]-=l)),this},l.manage_scroll=function(e){this.scroll_in("x",e),this.scroll_in("y",e)},l.calculate_dimensions=function(){this.window_height=s.height(),this.window_width=s.width()},l.drag_handler=function(t){if(t.target.nodeName,!this.disabled&&(1===t.which||u)&&!this.ignore_drag(t)){var n=this,r=!0;return this.$player=e(t.currentTarget),this.el_init_pos=this.get_actual_pos(this.$player),this.mouse_init_pos=this.get_mouse_pos(t),this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top,this.$body.on(a.move,function(e){var t=n.get_mouse_pos(e),i=Math.abs(t.left-n.mouse_init_pos.left),s=Math.abs(t.top-n.mouse_init_pos.top);return i>n.options.distance||s>n.options.distance?r?(r=!1,n.on_dragstart.call(n,e),!1):(n.is_dragging===!0&&n.on_dragmove.call(n,e),!1):!1}),u?undefined:!1}},l.on_dragstart=function(e){if(e.preventDefault(),this.is_dragging)return this;this.drag_start=this.is_dragging=!0;var t=this.$container.offset();return this.baseX=Math.round(t.left),this.baseY=Math.round(t.top),this.initial_container_width=this.options.container_width||this.$container.width(),"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1,this.scroll_offset_y=0,this.scroll_offset_x=0,this.el_init_offset=this.$player.offset(),this.player_width=this.$player.width(),this.player_height=this.$player.height(),this.set_limits(this.options.container_width),this.options.start&&this.options.start.call(this.$player,e,this.get_drag_data(e)),!1},l.on_dragmove=function(e){var t=this.get_drag_data(e);this.options.autoscroll&&this.manage_scroll(t),this.options.move_element&&(this.helper?this.$helper:this.$player).css({position:"absolute",left:t.position.left,top:t.position.top});var n=this.last_position||t.position;return t.prev_position=n,this.options.drag&&this.options.drag.call(this.$player,e,t),this.last_position=t.position,!1},l.on_dragstop=function(e){var t=this.get_drag_data(e);return this.drag_start=!1,this.options.stop&&this.options.stop.call(this.$player,e,t),this.helper&&this.$helper.remove(),!1},l.on_select_start=function(e){return this.disabled||this.ignore_drag(e)?undefined:!1},l.enable=function(){this.disabled=!1},l.disable=function(){this.disabled=!0},l.destroy=function(){this.disable(),this.$container.off(".gridster-draggable"),this.$body.off(".gridster-draggable"),e(t).off(".gridster-draggable"),e.removeData(this.$container,"drag")},l.ignore_drag=function(t){return this.options.handle?!e(t.target).is(this.options.handle):e(t.target).is(this.options.ignore_dragging.join(", "))},e.fn.drag=function(e){return new r(this,e)}}(jQuery,window,document),function(e,t,n){function r(t,n){this.options=e.extend(!0,{},i,n),this.$el=e(t),this.$wrapper=this.$el.parent(),this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w"),this.widgets=[],this.$changed=e([]),this.wrapper_width=this.$wrapper.width(),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.generated_stylesheets=[],this.$style_tags=e([]),this.init()}var i={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:1/0,min_rows:15,max_size_x:!1,autogrow_cols:!1,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y}},collision:{},draggable:{items:".gs-w",distance:4},resize:{enabled:!1,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[1/0,1/0],min_size:[1,1]}};r.generated_stylesheets=[];var s=r.prototype;s.init=function(){this.options.resize.enabled&&this.setup_resize(),this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.set_dom_grid_width(),this.$wrapper.addClass("ready"),this.draggable(),this.options.resize.enabled&&this.resizable(),e(t).bind("resize.gridster",throttle(e.proxy(this.recalculate_faux_grid,this),200))},s.disable=function(){return this.$wrapper.find(".player-revert").removeClass("player-revert"),this.drag_api.disable(),this},s.enable=function(){return this.drag_api.enable(),this},s.disable_resize=function(){return this.$el.addClass("gs-resize-disabled"),this.resize_api.disable(),this},s.enable_resize=function(){return this.$el.removeClass("gs-resize-disabled"),this.resize_api.enable(),this},s.add_widget=function(t,n,r,i,s,o,u){var a;n||(n=1),r||(r=1),!i&!s?a=this.next_position(n,r):(a={col:i,row:s},this.empty_cells(i,s,n,r));var f=e(t).attr({"data-col":a.col,"data-row":a.row,"data-sizex":n,"data-sizey":r}).addClass("gs-w").appendTo(this.$el).hide();return this.$widgets=this.$widgets.add(f),this.register_widget(f),this.add_faux_rows(a.size_y),o&&this.set_widget_max_size(f,o),u&&this.set_widget_min_size(f,u),this.set_dom_grid_width(),this.set_dom_grid_height(),this.drag_api.set_limits(this.cols*this.min_widget_width),f.fadeIn()},s.set_widget_min_size=function(e,t){if(e="number"==typeof e?this.$widgets.eq(e):e,!e.length)return this;var n=e.data("coords").grid;return n.min_size_x=t[0],n.min_size_y=t[1],this},s.set_widget_max_size=function(e,t){if(e="number"==typeof e?this.$widgets.eq(e):e,!e.length)return this;var n=e.data("coords").grid;return n.max_size_x=t[0],n.max_size_y=t[1],this},s.add_resize_handle=function(t){var n=this.options.resize.handle_append_to;return e(this.resize_handle_tpl).appendTo(n?e(n,t):t),this},s.resize_widget=function(e,t,n,r){var i=e.coords().grid,s=i.col,o=this.options.max_cols,u=i.size_y,a=i.col,f=a;t||(t=i.size_x),n||(n=i.size_y),1/0!==o&&(t=Math.min(t,o-s+1)),n>u&&this.add_faux_rows(Math.max(n-u,0));var l=s+t-1;l>this.cols&&this.add_faux_cols(l-this.cols);var c={col:f,row:i.row,size_x:t,size_y:n};return this.mutate_widget_in_gridmap(e,i,c),this.set_dom_grid_height(),this.set_dom_grid_width(),r&&r.call(this,c.size_x,c.size_y),e},s.mutate_widget_in_gridmap=function(t,n,r){n.size_x;var i=n.size_y,s=this.get_cells_occupied(n),o=this.get_cells_occupied(r),u=[];e.each(s.cols,function(t,n){-1===e.inArray(n,o.cols)&&u.push(n)});var a=[];e.each(o.cols,function(t,n){-1===e.inArray(n,s.cols)&&a.push(n)});var f=[];e.each(s.rows,function(t,n){-1===e.inArray(n,o.rows)&&f.push(n)});var l=[];if(e.each(o.rows,function(t,n){-1===e.inArray(n,s.rows)&&l.push(n)}),this.remove_from_gridmap(n),a.length){var c=[r.col,r.row,r.size_x,Math.min(i,r.size_y),t];this.empty_cells.apply(this,c)}if(l.length){var h=[r.col,r.row,r.size_x,r.size_y,t];this.empty_cells.apply(this,h)}if(n.col=r.col,n.row=r.row,n.size_x=r.size_x,n.size_y=r.size_y,this.add_to_gridmap(r,t),t.removeClass("player-revert"),t.data("coords").update({width:r.size_x*this.options.widget_base_dimensions[0]+2*(r.size_x-1)*this.options.widget_margins[0],height:r.size_y*this.options.widget_base_dimensions[1]+2*(r.size_y-1)*this.options.widget_margins[1]}),t.attr({"data-col":r.col,"data-row":r.row,"data-sizex":r.size_x,"data-sizey":r.size_y}),u.length){var p=[u[0],r.row,u.length,Math.min(i,r.size_y),t];this.remove_empty_cells.apply(this,p)}if(f.length){var d=[r.col,r.row,r.size_x,r.size_y,t];this.remove_empty_cells.apply(this,d)}return this.move_widget_up(t),this},s.empty_cells=function(t,n,r,i,s){var o=this.widgets_below({col:t,row:n-i,size_x:r,size_y:i});return o.not(s).each(e.proxy(function(t,r){var s=e(r).coords().grid;if(n+i-1>=s.row){var o=n+i-s.row;this.move_widget_down(e(r),o)}},this)),this.set_dom_grid_height(),this},s.remove_empty_cells=function(t,n,r,i,s){var o=this.widgets_below({col:t,row:n,size_x:r,size_y:i});return o.not(s).each(e.proxy(function(t,n){this.move_widget_up(e(n),i)},this)),this.set_dom_grid_height(),this},s.next_position=function(e,t){e||(e=1),t||(t=1);for(var n,r=this.gridmap,i=r.length,s=[],o=1;i>o;o++){n=r[o].length;for(var u=1;n>=u;u++){var a=this.can_move_to({size_x:e,size_y:t},o,u);a&&s.push({col:o,row:u,size_y:t,size_x:e})}}return s.length?this.sort_by_row_and_col_asc(s)[0]:!1},s.remove_widget=function(t,n,r){var i=t instanceof e?t:e(t),s=i.coords().grid;e.isFunction(n)&&(r=n,n=!1),this.cells_occupied_by_placeholder={},this.$widgets=this.$widgets.not(i);var o=this.widgets_below(i);return this.remove_from_gridmap(s),i.fadeOut(e.proxy(function(){i.remove(),n||o.each(e.proxy(function(t,n){this.move_widget_up(e(n),s.size_y)},this)),this.set_dom_grid_height(),r&&r.call(this,t)},this)),this},s.remove_all_widgets=function(t){return this.$widgets.each(e.proxy(function(e,n){this.remove_widget(n,!0,t)},this)),this},s.serialize=function(t){t||(t=this.$widgets);var n=[];return t.each(e.proxy(function(t,r){n.push(this.options.serialize_params(e(r),e(r).coords().grid))},this)),n},s.serialize_changed=function(){return this.serialize(this.$changed)},s.register_widget=function(t){var n={col:parseInt(t.attr("data-col"),10),row:parseInt(t.attr("data-row"),10),size_x:parseInt(t.attr("data-sizex"),10),size_y:parseInt(t.attr("data-sizey"),10),max_size_x:parseInt(t.attr("data-max-sizex"),10)||!1,max_size_y:parseInt(t.attr("data-max-sizey"),10)||!1,min_size_x:parseInt(t.attr("data-min-sizex"),10)||!1,min_size_y:parseInt(t.attr("data-min-sizey"),10)||!1,el:t};return this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:n.size_x,size_y:n.size_y},n.col,n.row)&&(e.extend(n,this.next_position(n.size_x,n.size_y)),t.attr({"data-col":n.col,"data-row":n.row,"data-sizex":n.size_x,"data-sizey":n.size_y})),t.data("coords",t.coords()),t.data("coords").grid=n,this.add_to_gridmap(n,t),this.options.resize.enabled&&this.add_resize_handle(t),this},s.update_widget_position=function(e,t){return this.for_each_cell_occupied(e,function(e,n){return this.gridmap[e]?(this.gridmap[e][n]=t,undefined):this}),this},s.remove_from_gridmap=function(e){return this.update_widget_position(e,!1)},s.add_to_gridmap=function(t,n){if(this.update_widget_position(t,n||t.el),t.el){var r=this.widgets_below(t.el);r.each(e.proxy(function(t,n){this.move_widget_up(e(n))},this))}},s.draggable=function(){var t=this,n=e.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON","."+this.options.resize.handle_class],start:function(n,r){t.$widgets.filter(".player-revert").removeClass("player-revert"),t.$player=e(this),t.$helper=e(r.$helper),t.helper=!t.$helper.is(t.$player),t.on_start_drag.call(t,n,r),t.$el.trigger("gridster:dragstart")},stop:function(e,n){t.on_stop_drag.call(t,e,n),t.$el.trigger("gridster:dragstop")},drag:throttle(function(e,n){t.on_drag.call(t,e,n),t.$el.trigger("gridster:drag")},60)});return this.drag_api=this.$el.drag(n),this},s.resizable=function(){return this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:!1,resize:!0,limit:this.options.autogrow_cols?!1:!0,start:e.proxy(this.on_start_resize,this),stop:e.proxy(function(t,n){delay(e.proxy(function(){this.on_stop_resize(t,n)},this),120)},this),drag:throttle(e.proxy(this.on_resize,this),60)}),this},s.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var t=this.options.resize.axes,n='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';return this.resize_handle_tpl=e.map(t,function(e){return n.replace("{type}",e)}).join(""),this},s.on_start_drag=function(t,n){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging"),this.highest_col=this.get_highest_occupied_cell().col,this.$player.addClass("player"),this.player_grid_data=this.$player.coords().grid,this.placeholder_grid_data=e.extend({},this.player_grid_data),this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height),this.set_dom_grid_width(this.cols);var r=this.player_grid_data.size_x,i=this.cols-this.highest_col;this.options.autogrow_cols&&r>=i&&this.add_faux_cols(Math.min(r-i,1));var s=this.faux_grid,o=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data),this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.last_cols=[],this.last_rows=[],this.collision_api=this.$helper.collision(s,this.options.collision),this.$preview_holder=e("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:o.width,height:o.height}}).appendTo(this.$el),this.options.draggable.start&&this.options.draggable.start.call(this,t,n)},s.on_drag=function(e,t){if(null===this.$player)return!1;var n={left:t.position.left+this.baseX,top:t.position.top+this.baseY};if(this.options.autogrow_cols){var r=this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1;r>=this.cols-1&&this.options.max_cols>=this.cols+1&&(this.add_faux_cols(1),this.set_dom_grid_width(this.cols+1),this.drag_api.set_limits(this.container_width)),this.collision_api.set_colliders(this.faux_grid)}this.colliders_data=this.collision_api.get_closest_colliders(n),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.helper&&this.$player&&this.$player.css({left:t.position.left,top:t.position.top}),this.options.draggable.drag&&this.options.draggable.drag.call(this,e,t)},s.on_stop_drag=function(e,t){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging"),t.position.left=t.position.left+this.baseX,t.position.top=t.position.top+this.baseY,this.colliders_data=this.collision_api.get_closest_colliders(t.position),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""}),this.$changed=this.$changed.add(this.$player),this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data),this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row),this.$player.coords().grid.row=this.placeholder_grid_data.row,this.$player.coords().grid.col=this.placeholder_grid_data.col,this.options.draggable.stop&&this.options.draggable.stop.call(this,e,t),this.$preview_holder.remove(),this.$player=null,this.$helper=null,this.placeholder_grid_data={},this.player_grid_data={},this.cells_occupied_by_placeholder={},this.cells_occupied_by_player={},this.set_dom_grid_height(),this.set_dom_grid_width(),this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)},s.on_start_resize=function(t,n){this.$resized_widget=n.$player.closest(".gs-w"),this.resize_coords=this.$resized_widget.coords(),this.resize_wgd=this.resize_coords.grid,this.resize_initial_width=this.resize_coords.coords.width,this.resize_initial_height=this.resize_coords.coords.height,this.resize_initial_sizex=this.resize_coords.grid.size_x,this.resize_initial_sizey=this.resize_coords.grid.size_y,this.resize_initial_col=this.resize_coords.grid.col,this.resize_last_sizex=this.resize_initial_sizex,this.resize_last_sizey=this.resize_initial_sizey,this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1),this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1],this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1,this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1,this.resize_initial_last_col=this.get_highest_occupied_cell().col,this.set_dom_grid_width(this.cols),this.resize_dir={right:n.$player.is("."+this.resize_handle_class+"-x"),bottom:n.$player.is("."+this.resize_handle_class+"-y")},this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var r=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=e("<"+r+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el),this.$resized_widget.addClass("resizing"),this.options.resize.start&&this.options.resize.start.call(this,t,n,this.$resized_widget),this.$el.trigger("gridster:resizestart")},s.on_stop_resize=function(t,n){this.$resized_widget.removeClass("resizing").css({width:"",height:""}),delay(e.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""}),this.options.resize.stop&&this.options.resize.stop.call(this,t,n,this.$resized_widget),this.$el.trigger("gridster:resizestop")},this),300),this.set_dom_grid_width(),this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)},s.on_resize=function(e,t){var n,r=t.pointer.diff_left,i=t.pointer.diff_top,s=this.options.widget_base_dimensions[0],o=this.options.widget_base_dimensions[1],u=this.options.widget_margins[0],a=this.options.widget_margins[1],f=this.resize_max_size_x,l=this.resize_min_size_x,c=this.resize_max_size_y,h=this.resize_min_size_y,p=this.options.autogrow_cols,d=1/0,v=1/0,m=Math.ceil(r/(s+2*u)-.2),g=Math.ceil(i/(o+2*a)-.2),y=Math.max(1,this.resize_initial_sizex+m),b=Math.max(1,this.resize_initial_sizey+g),w=this.container_width/this.min_widget_width-this.resize_initial_col+1,E=w*this.min_widget_width-2*u;if(y=Math.max(Math.min(y,f),l),y=Math.min(w,y),n=f*s+2*(y-1)*u,d=Math.min(n,E),min_width=l*s+2*(y-1)*u,b=Math.max(Math.min(b,c),h),v=c*o+2*(b-1)*a,min_height=h*o+2*(b-1)*a,this.resize_dir.right?b=this.resize_initial_sizey:this.resize_dir.bottom&&(y=this.resize_initial_sizex),p){var S=this.resize_initial_col+y-1;p&&S>=this.resize_initial_last_col&&(this.set_dom_grid_width(Math.max(S+1,this.cols)),S>this.cols&&this.add_faux_cols(S-this.cols))}var x={};!this.resize_dir.bottom&&(x.width=Math.max(Math.min(this.resize_initial_width+r,d),min_width)),!this.resize_dir.right&&(x.height=Math.max(Math.min(this.resize_initial_height+i,v),min_height)),this.$resized_widget.css(x),(y!==this.resize_last_sizex||b!==this.resize_last_sizey)&&(this.resize_widget(this.$resized_widget,y,b),this.set_dom_grid_width(this.cols),this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":y,"data-sizey":b})),this.options.resize.resize&&this.options.resize.resize.call(this,e,t,this.$resized_widget),this.$el.trigger("gridster:resize"),this.resize_last_sizex=y,this.resize_last_sizey=b},s.on_overlapped_column_change=function(t,n){if(!this.colliders_data.length)return this;var r,i=this.get_targeted_columns(this.colliders_data[0].el.data.col),s=this.last_cols.length,o=i.length;for(r=0;o>r;r++)-1===e.inArray(i[r],this.last_cols)&&(t||e.noop).call(this,i[r]);for(r=0;s>r;r++)-1===e.inArray(this.last_cols[r],i)&&(n||e.noop).call(this,this.last_cols[r]);return this.last_cols=i,this},s.on_overlapped_row_change=function(t,n){if(!this.colliders_data.length)return this;var r,i=this.get_targeted_rows(this.colliders_data[0].el.data.row),s=this.last_rows.length,o=i.length;for(r=0;o>r;r++)-1===e.inArray(i[r],this.last_rows)&&(t||e.noop).call(this,i[r]);for(r=0;s>r;r++)-1===e.inArray(this.last_rows[r],i)&&(n||e.noop).call(this,this.last_rows[r]);this.last_rows=i},s.set_player=function(e,t,n){var r=this;n||this.empty_cells_player_occupies();var i=n?{col:e}:r.colliders_data[0].el.data,s=i.col,o=t||i.row;this.player_grid_data={col:s,row:o,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x},this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var u=this.get_widgets_overlapped(this.player_grid_data),a=this.widgets_constraints(u);if(this.manage_movements(a.can_go_up,s,o),this.manage_movements(a.can_not_go_up,s,o),!u.length){var f=this.can_go_player_up(this.player_grid_data);f!==!1&&(o=f),this.set_placeholder(s,o)}return{col:s,row:o}},s.widgets_constraints=function(t){var n,r=e([]),i=[],s=[];return t.each(e.proxy(function(t,n){var u=e(n),a=u.coords().grid;this.can_go_widget_up(a)?(r=r.add(u),i.push(a)):s.push(a)},this)),n=t.not(r),{can_go_up:this.sort_by_row_asc(i),can_not_go_up:this.sort_by_row_desc(s)}},s.sort_by_row_asc=function(t){return t=t.sort(function(t,n){return t.row||(t=e(t).coords().grid,n=e(n).coords().grid),t.row>n.row?1:-1})},s.sort_by_row_and_col_asc=function(e){return e=e.sort(function(e,t){return e.row>t.row||e.row===t.row&&e.col>t.col?1:-1})},s.sort_by_col_asc=function(e){return e=e.sort(function(e,t){return e.col>t.col?1:-1})},s.sort_by_row_desc=function(e){return e=e.sort(function(e,t){return e.row+e.size_y<t.row+t.size_y?1:-1})},s.manage_movements=function(t,n,r){return e.each(t,e.proxy(function(e,t){var i=t,s=i.el,o=this.can_go_widget_up(i);if(o)this.move_widget_to(s,o),this.set_placeholder(n,o+i.size_y);else{var u=this.can_go_player_up(this.player_grid_data);if(!u){var a=r+this.player_grid_data.size_y-i.row;this.move_widget_down(s,a),this.set_placeholder(n,r)}}},this)),this},s.is_player=function(e,t){if(t&&!this.gridmap[e])return!1;var n=t?this.gridmap[e][t]:e;return n&&(n.is(this.$player)||n.is(this.$helper))},s.is_player_in=function(t,n){var r=this.cells_occupied_by_player||{};return e.inArray(t,r.cols)>=0&&e.inArray(n,r.rows)>=0},s.is_placeholder_in=function(t,n){var r=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(t)&&e.inArray(n,r.rows)>=0},s.is_placeholder_in_col=function(t){var n=this.cells_occupied_by_placeholder||[];return e.inArray(t,n.cols)>=0},s.is_empty=function(e,t){return this.gridmap[e]!==undefined?this.gridmap[e][t]!==undefined&&this.gridmap[e][t]===!1?!0:!1:!0},s.is_occupied=function(e,t){return this.gridmap[e]?this.gridmap[e][t]?!0:!1:!1},s.is_widget=function(e,t){var n=this.gridmap[e];return n?(n=n[t],n?n:!1):!1},s.is_widget_under_player=function(e,t){return this.is_widget(e,t)?this.is_player_in(e,t):!1},s.get_widgets_under_player=function(t){t||(t=this.cells_occupied_by_player||{cols:[],rows:[]});var n=e([]);return e.each(t.cols,e.proxy(function(r,i){e.each(t.rows,e.proxy(function(e,t){this.is_widget(i,t)&&(n=n.add(this.gridmap[i][t]))},this))},this)),n},s.set_placeholder=function(t,n){var r=e.extend({},this.placeholder_grid_data),i=this.widgets_below({col:r.col,row:r.row,size_y:r.size_y,size_x:r.size_x}),s=t+r.size_x-1;s>this.cols&&(t-=s-t);var o=n>this.placeholder_grid_data.row,u=this.placeholder_grid_data.col!==t;this.placeholder_grid_data.col=t,this.placeholder_grid_data.row=n,this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.$preview_holder.attr({"data-row":n,"data-col":t}),(o||u)&&i.each(e.proxy(function(n,i){this.move_widget_up(e(i),this.placeholder_grid_data.col-t+r.size_y)},this));var a=this.get_widgets_under_player(this.cells_occupied_by_placeholder);a.length&&a.each(e.proxy(function(t,i){var s=e(i);this.move_widget_down(s,n+r.size_y-s.data("coords").grid.row)},this))},s.can_go_player_up=function(e){var t=e.row+e.size_y-1,n=!0,r=[],i=1e4,s=this.get_widgets_under_player();return this.for_each_column_occupied(e,function(e){var u=this.gridmap[e],a=t+1;for(r[e]=[];--a>0&&(this.is_empty(e,a)||this.is_player(e,a)||this.is_widget(e,a)&&u[a].is(s));)r[e].push(a),i=i>a?a:i;return 0===r[e].length?(n=!1,!0):(r[e].sort(function(e,t){return e-t}),undefined)}),n?this.get_valid_rows(e,r,i):!1},s.can_go_widget_up=function(e){var t=e.row+e.size_y-1,n=!0,r=[],i=1e4;return this.for_each_column_occupied(e,function(s){var o=this.gridmap[s];r[s]=[];for(var u=t+1;--u>0&&(!this.is_widget(s,u)||this.is_player_in(s,u)||o[u].is(e.el));)this.is_player(s,u)||this.is_placeholder_in(s,u)||this.is_player_in(s,u)||r[s].push(u),i>u&&(i=u);return 0===r[s].length?(n=!1,!0):(r[s].sort(function(e,t){return e-t}),undefined)}),n?this.get_valid_rows(e,r,i):!1},s.get_valid_rows=function(t,n,r){for(var i=t.row,s=t.row+t.size_y-1,o=t.size_y,u=r-1,a=[];s>=++u;){var f=!0;if(e.each(n,function(t,n){e.isArray(n)&&-1===e.inArray(u,n)&&(f=!1)}),f===!0&&(a.push(u),a.length===o))break}var l=!1;return 1===o?a[0]!==i&&(l=a[0]||!1):a[0]!==i&&(l=this.get_consecutive_numbers_index(a,o)),l},s.get_consecutive_numbers_index=function(e,t){for(var n=e.length,r=[],i=!0,s=-1,o=0;n>o;o++){if(i||e[o]===s+1){if(r.push(o),r.length===t)break;i=!1}else r=[],i=!0;s=e[o]}return r.length>=t?e[r[0]]:!1},s.get_widgets_overlapped=function(){var t=e([]),n=[],r=this.cells_occupied_by_player.rows.slice(0);return r.reverse(),e.each(this.cells_occupied_by_player.cols,e.proxy(function(i,s){e.each(r,e.proxy(function(r,i){if(!this.gridmap[s])return!0;var u=this.gridmap[s][i];this.is_occupied(s,i)&&!this.is_player(u)&&-1===e.inArray(u,n)&&(t=t.add(u),n.push(u))},this))},this)),t},s.on_start_overlapping_column=function(e){this.set_player(e,!1)},s.on_start_overlapping_row=function(e){this.set_player(!1,e)},s.on_stop_overlapping_column=function(e){this.set_player(e,!1);var t=this;this.for_each_widget_below(e,this.cells_occupied_by_player.rows[0],function(){t.move_widget_up(this,t.player_grid_data.size_y)})},s.on_stop_overlapping_row=function(e){this.set_player(!1,e);for(var t=this,n=this.cells_occupied_by_player.cols,r=0,i=n.length;i>r;r++)this.for_each_widget_below(n[r],e,function(){t.move_widget_up(this,t.player_grid_data.size_y)})},s.move_widget_to=function(t,n){var r=this,i=t.coords().grid;n-i.row;var s=this.widgets_below(t),o=this.can_move_to(i,i.col,n,t);return o===!1?!1:(this.remove_from_gridmap(i),i.row=n,this.add_to_gridmap(i),t.attr("data-row",n),this.$changed=this.$changed.add(t),s.each(function(t,n){var i=e(n),s=i.coords().grid,o=r.can_go_widget_up(s);o&&o!==s.row&&r.move_widget_to(i,o)}),this)},s.move_widget_up=function(t,n){var r=t.coords().grid,i=r.row,s=[];return n||(n=1),this.can_go_up(t)?(this.for_each_column_occupied(r,function(r){if(-1===e.inArray(t,s)){var u=t.coords().grid,a=i-n;if(a=this.can_go_up_to_row(u,r,a),!a)return!0;var f=this.widgets_below(t);this.remove_from_gridmap(u),u.row=a,this.add_to_gridmap(u),t.attr("data-row",u.row),this.$changed=this.$changed.add(t),s.push(t),f.each(e.proxy(function(t,r){this.move_widget_up(e(r),n)},this))}}),undefined):!1},s.move_widget_down=function(t,n){var r,i,s,o;if(0>=n)return!1;if(r=t.coords().grid,i=r.row,s=[],o=n,!t)return!1;if(-1===e.inArray(t,s)){var u=t.coords().grid,a=i+n,f=this.widgets_below(t);this.remove_from_gridmap(u),f.each(e.proxy(function(t,n){var r=e(n),i=r.coords().grid,s=this.displacement_diff(i,u,o);s>0&&this.move_widget_down(r,s)},this)),u.row=a,this.update_widget_position(u,t),t.attr("data-row",u.row),this.$changed=this.$changed.add(t),s.push(t)}},s.can_go_up_to_row=function(t,n,r){var i,s=this.gridmap,o=!0,u=[],a=t.row;if(this.for_each_column_occupied(t,function(e){for(s[e],u[e]=[],i=a;i--&&this.is_empty(e,i)&&!this.is_placeholder_in(e,i);)u[e].push(i);return u[e].length?undefined:(o=!1,!0)}),!o)return!1;for(i=r,i=1;a>i;i++){for(var f=!0,l=0,c=u.length;c>l;l++)u[l]&&-1===e.inArray(i,u[l])&&(f=!1);if(f===!0){o=i;break}}return o},s.displacement_diff=function(e,t,n){var r=e.row,i=[],s=t.row+t.size_y;this.for_each_column_occupied(e,function(e){for(var t=0,n=s;r>n;n++)this.is_empty(e,n)&&(t+=1);i.push(t)});var o=Math.max.apply(Math,i);return n-=o,n>0?n:0},s.widgets_below=function(t){var n=e.isPlainObject(t)?t:t.coords().grid,r=this;this.gridmap;var i=n.row+n.size_y-1,s=e([]);return this.for_each_column_occupied(n,function(t){r.for_each_widget_below(t,i,function(){return r.is_player(this)||-1!==e.inArray(this,s)?undefined:(s=s.add(this),!0)})}),this.sort_by_row_asc(s)},s.set_cells_player_occupies=function(e,t){return this.remove_from_gridmap(this.placeholder_grid_data),this.placeholder_grid_data.col=e,this.placeholder_grid_data.row=t,this.add_to_gridmap(this.placeholder_grid_data,this.$player),this},s.empty_cells_player_occupies=function(){return this.remove_from_gridmap(this.placeholder_grid_data),this},s.can_go_up=function(e){var t=e.coords().grid,n=t.row,r=n-1;this.gridmap;var i=!0;return 1===n?!1:(this.for_each_column_occupied(t,function(e){return this.is_widget(e,r),this.is_occupied(e,r)||this.is_player(e,r)||this.is_placeholder_in(e,r)||this.is_player_in(e,r)?(i=!1,!0):undefined}),i)},s.can_move_to=function(e,t,n,r){this.gridmap;var i=e.el,s={size_y:e.size_y,size_x:e.size_x,col:t,row:n},o=!0,u=t+e.size_x-1;return u>this.cols?!1:r&&n+e.size_y-1>r?!1:(this.for_each_cell_occupied(s,function(t,n){var r=this.is_widget(t,n);!r||e.el&&!r.is(i)||(o=!1)}),o)},s.get_targeted_columns=function(e){for(var t=(e||this.player_grid_data.col)+(this.player_grid_data.size_x-1),n=[],r=e;t>=r;r++)n.push(r);return n},s.get_targeted_rows=function(e){for(var t=(e||this.player_grid_data.row)+(this.player_grid_data.size_y-1),n=[],r=e;t>=r;r++)n.push(r);return n},s.get_cells_occupied=function(t){var n,r={cols:[],rows:[]};for(arguments[1]instanceof e&&(t=arguments[1].coords().grid),n=0;t.size_x>n;n++){var i=t.col+n;r.cols.push(i)}for(n=0;t.size_y>n;n++){var s=t.row+n;r.rows.push(s)}return r},s.for_each_cell_occupied=function(e,t){return this.for_each_column_occupied(e,function(n){this.for_each_row_occupied(e,function(e){t.call(this,n,e)})}),this},s.for_each_column_occupied=function(e,t){for(var n=0;e.size_x>n;n++){var r=e.col+n;t.call(this,r,e)}},s.for_each_row_occupied=function(e,t){for(var n=0;e.size_y>n;n++){var r=e.row+n;t.call(this,r,e)}},s._traversing_widgets=function(t,n,r,i,s){var o=this.gridmap;if(o[r]){var u,a,f=t+"/"+n;if(arguments[2]instanceof e){var l=arguments[2].coords().grid;r=l.col,i=l.row,s=arguments[3]}var c=[],h=i,p={"for_each/above":function(){for(;h--&&!(h>0&&this.is_widget(r,h)&&-1===e.inArray(o[r][h],c)&&(u=s.call(o[r][h],r,h),c.push(o[r][h]),u)););},"for_each/below":function(){for(h=i+1,a=o[r].length;a>h&&(!this.is_widget(r,h)||-1!==e.inArray(o[r][h],c)||(u=s.call(o[r][h],r,h),c.push(o[r][h]),!u));h++);}};p[f]&&p[f].call(this)}},s.for_each_widget_above=function(e,t,n){return this._traversing_widgets("for_each","above",e,t,n),this},s.for_each_widget_below=function(e,t,n){return this._traversing_widgets("for_each","below",e,t,n),this},s.get_highest_occupied_cell=function(){for(var e,t=this.gridmap,n=t[1].length,r=[],i=[],s=t.length-1;s>=1;s--)for(e=n-1;e>=1;e--)if(this.is_widget(s,e)){r.push(e),i.push(s);break}return{col:Math.max.apply(Math,i),row:Math.max.apply(Math,r)}},s.get_widgets_from=function(t,n){this.gridmap;var r=e();return t&&(r=r.add(this.$widgets.filter(function(){var n=e(this).attr("data-col");return n===t||n>t}))),n&&(r=r.add(this.$widgets.filter(function(){var t=e(this).attr("data-row");return t===n||t>n}))),r},s.set_dom_grid_height=function(e){if(e===undefined){var t=this.get_highest_occupied_cell().row;e=t*this.min_widget_height}return this.container_height=e,this.$el.css("height",this.container_height),this},s.set_dom_grid_width=function(e){e===undefined&&(e=this.get_highest_occupied_cell().col);var t=this.options.autogrow_cols?this.options.max_cols:this.cols;return e=Math.min(t,Math.max(e,this.options.min_cols)),this.container_width=e*this.min_widget_width,this.$el.css("width",this.container_width),this},s.generate_stylesheet=function(t){var n,i="",s=this.options.max_size_x||this.cols;t||(t={}),t.cols||(t.cols=this.cols),t.rows||(t.rows=this.rows),t.namespace||(t.namespace=this.options.namespace),t.widget_base_dimensions||(t.widget_base_dimensions=this.options.widget_base_dimensions),t.widget_margins||(t.widget_margins=this.options.widget_margins),t.min_widget_width=2*t.widget_margins[0]+t.widget_base_dimensions[0],t.min_widget_height=2*t.widget_margins[1]+t.widget_base_dimensions[1];var o=e.param(t);if(e.inArray(o,r.generated_stylesheets)>=0)return!1;for(this.generated_stylesheets.push(o),r.generated_stylesheets.push(o),n=t.cols;n>=0;n--)i+=t.namespace+' [data-col="'+(n+1)+'"] { left:'+(n*t.widget_base_dimensions[0]+n*t.widget_margins[0]+(n+1)*t.widget_margins[0])+"px; }\n";for(n=t.rows;n>=0;n--)i+=t.namespace+' [data-row="'+(n+1)+'"] { top:'+(n*t.widget_base_dimensions[1]+n*t.widget_margins[1]+(n+1)*t.widget_margins[1])+"px; }\n";for(var u=1;t.rows>=u;u++)i+=t.namespace+' [data-sizey="'+u+'"] { height:'+(u*t.widget_base_dimensions[1]+(u-1)*2*t.widget_margins[1])+"px; }\n";for(var a=1;s>=a;a++)i+=t.namespace+' [data-sizex="'+a+'"] { width:'+(a*t.widget_base_dimensions[0]+(a-1)*2*t.widget_margins[0])+"px; }\n";return this.add_style_tag(i)},s.add_style_tag=function(e){var t=n,r=t.createElement("style");return t.getElementsByTagName("head")[0].appendChild(r),r.setAttribute("type","text/css"),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(n.createTextNode(e)),this.$style_tags=this.$style_tags.add(r),this},s.remove_style_tags=function(){var t=r.generated_stylesheets,n=this.generated_stylesheets;this.$style_tags.remove(),r.generated_stylesheets=e.map(t,function(t){return-1===e.inArray(t,n)?t:undefined})},s.generate_faux_grid=function(e,t){this.faux_grid=[],this.gridmap=[];var n,r;for(n=t;n>0;n--)for(this.gridmap[n]=[],r=e;r>0;r--)this.add_faux_cell(r,n);return this},s.add_faux_cell=function(t,n){var r=e({left:this.baseX+(n-1)*this.min_widget_width,top:this.baseY+(t-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:n,row:t,original_col:n,original_row:t}).coords();return e.isArray(this.gridmap[n])||(this.gridmap[n]=[]),this.gridmap[n][t]=!1,this.faux_grid.push(r),this},s.add_faux_rows=function(e){for(var t=this.rows,n=t+(e||1),r=n;r>t;r--)for(var i=this.cols;i>=1;i--)this.add_faux_cell(r,i);return this.rows=n,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},s.add_faux_cols=function(e){var t=this.cols,n=t+(e||1);n=Math.min(n,this.options.max_cols);for(var r=t+1;n>=r;r++)for(var i=this.rows;i>=1;i--)this.add_faux_cell(i,r);return this.cols=n,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},s.recalculate_faux_grid=function(){var n=this.$wrapper.width();return this.baseX=(e(t).width()-n)/2,this.baseY=this.$wrapper.offset().top,e.each(this.faux_grid,e.proxy(function(e,t){this.faux_grid[e]=t.update({left:this.baseX+(t.data.col-1)*this.min_widget_width,top:this.baseY+(t.data.row-1)*this.min_widget_height})},this)),this},s.get_widgets_from_DOM=function(){return this.$widgets.each(e.proxy(function(t,n){this.register_widget(e(n))},this)),this},s.generate_grid_and_stylesheet=function(){var n=this.$wrapper.width(),r=this.options.max_cols,i=Math.floor(n/this.min_widget_width)+this.options.extra_cols,s=this.$widgets.map(function(){return e(this).attr("data-col")}).get();s.length||(s=[0]);var o=Math.max.apply(Math,s);this.cols=Math.max(o,i,this.options.min_cols),1/0!==r&&r>=o&&this.cols>r&&(this.cols=r);var u=this.options.extra_rows;return this.$widgets.each(function(t,n){u+=+e(n).attr("data-sizey")}),this.rows=Math.max(u,this.options.min_rows),this.baseX=(e(t).width()-n)/2,this.baseY=this.$wrapper.offset().top,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this.generate_faux_grid(this.rows,this.cols)},s.destroy=function(n){return this.$el.removeData("gridster"),e(t).unbind(".gridster"),this.drag_api&&this.drag_api.destroy(),this.remove_style_tags(),n&&this.$el.remove(),this},e.fn.gridster=function(t){return this.each(function(){e(this).data("gridster")||e(this).data("gridster",new r(this,t))})},e.Gridster=s}(jQuery,window,document);